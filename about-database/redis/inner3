主从：
    slaveof  ip port 就可以成为从。
    同步：
        savle 发送sync，主执行bgsave，并缓存当前开始的新命令，
        发送rdb文件给从，完成后，发送缓存给从
    传播：
        同步后，主每次有写命令，发给从

    断线后，
        重连必定sync，又会重新接受一遍，所以有缺点

    改进：
        psync，部分重同步
        有一个固定长度的队列，保存最近的n条命令，同时两边保存复制偏移量，每次复制都增加
        断线重连后，如果客户端psync返回的偏移量的差在队列长度范围内，就psync，一条一条发，
        否则sync， 具体的队列大小最好是平局断线时间×每秒写大小，可以调整repl-backlog-size

        每个服务器都有一个id，如果id对不上也要full
        从服务器利用psync以及设定的大小决定要不要使用full sync
        主服务器也会回应从，决定是怎么同步

主从链接：
    互相建立socket，
    ping 测试通信
    masterauth如果设置，客户端要验证
         主检验requirepass 的值
    info replication 这个master发送，客户端监听使用的，报告从状态
